name: Fire Test

on:
  workflow_dispatch:

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v5

    - name: Set up Python
      uses: actions/setup-python@v6
      with:
        python-version: '3.11'

    - name: Install package
      run: |
        pip install -e .

    - name: Configure mini-extra
      run: |
        mini-extra config set MSWEA_CONFIGURED 'true'

    - name: Clone test repository
      run: |
        git clone https://github.com/swe-agent/test-repo

    - name: Change to test repo directory
      run: cd test-repo
    - name: Run mini with task
      working-directory: test-repo
      env:
        OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
      run: |
        mini --exit-immediately -y --model openai/gpt-5-mini -t "$(cat << 'EOF'
        I'm running missing_colon.py as follows:

        division(23, 0)

        but I get the following error:

          File "/Users/fuchur/Documents/24/git_sync/swe-agent-test-repo/tests/./missing_colon.py", line 4
            def division(a: float, b: float) -> float
                                                     ^
        SyntaxError: invalid syntax
        EOF
        )"
